<!DOCTYPE html>
<html lang="en" class="h-100">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <title>Emo Track</title>

        <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/cover/">
        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        
        <!-- Custom styles for this template -->
        <link rel="stylesheet" type="text/css" href="/css/index.css">
        <!-- Slider stylesheet-->
        <link rel="stylesheet" type="text/css" href="/circular-slider/lib/circular-slider.css"/>


    </head>

    <body class="text-center text-white emo-bg">
        <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">

            <%-  include('topbar.ejs') %>

            <main class="px-3">
                <container>                                      
                    <% if (loggedin) { %>
                        <h2><%= `${user.username}'s Snapshots `%></h2>
                        <h5>Click a snapshot to edit your triggers and notes</h5>
                        <% } else { %>
                        <h2>My Snapshots</h2>
                        <% } %>
                        <div class="row row-cols-md-3 g-4 mx-auto text-center">
                            <% var dateOptions = { weekday: "long", year: "numeric", month: "long", day: "numeric", }; %>                        
                                    <% snapshots.forEach((row) => { %>
                                <div class="col-lg-4 ">
                                    <div class="card text-white w-100  h-100 bg-dark">
                                <% if (row) { %>
                                    <% var snapshotid = row.emotional_snapshot_id; %>
                                    <% if (loggedin) { %> 

                            <% var snapshotdate = row.created_ts; %>
                            <% if (snapshotdate) { %>
                                <% var inputdate = new Date(snapshotdate); %>
                                <% var formattedDate = inputdate.toLocaleString("en-GB", dateOptions); %>
                            <% } %>

                            <% if (row.modified_ts) { %>
                                <% var snapshotupdatedate = row.modified_ts; %>
                                    <% if (snapshotupdatedate) { %>
                                        <% var inputupdatedate = new Date(snapshotdate); %>
                                        <% var formattedUpdateDate = inputupdatedate.toLocaleString("en-GB", dateOptions); %>
                                    <% } %>
                                <% } %>


                                    <a href='/user/<%=userid%>/edit/<%= snapshotid %>' class="card-body">
                                        <h5 class="card-title text-white">Created: <%= formattedDate %></h5>
                                
                                        <p class="card-content text-white">
                                            <% if (row.enjoyment_level) { %>
                                                <span>Enjoyment:  <%=  row.enjoyment_level ; %> </span>
                                            <% } %>

                                            <% if (row.sadness_level) { %>
                                               <span> Sadness:  <%=  row.sadness_level ; %></span>
                                            <% } %>

                                            <% if (row.anger_level) { %>
                                               <span> Anger:  <%=  row.anger_level ; %></span>
                                            <% } %>

                                            <% if (row.contempt_level) { %>
                                               <span> Contempt:  <%=  row.contempt_level ; %></span>
                                            <% } %>

                                            <% if (row.disgust_level) { %>
                                               <span> Disgust:  <%=  row.disgust_level ; %></span>
                                            <% } %>

                                            <% if (row.fear_level) { %>
                                               <span> Fear:  <%=  row.fear_level ; %></span>
                                            <% } %>

                                            <% if (row.surprise_level) { %>
                                               <span> Suprise:  <%=  row.surprise_level ; %></span>
                                            <% } %>
                                            
                                            <% if (row.notes) { %>
                                                <p class="card-text text-white">Notes: <%= row.notes; %> </p>
                                            <% } %>
                                        </p>
                                        <p class="card-text text-white">
                                            <% if (row.default_trigger_ids && row.default_trigger_ids.length > 0) { %>
                                                <% row.default_trigger_ids.forEach((triggerSelected) => { %>
                                                    <li class="text-white "><%= defaultTriggers.find(item => item.default_trigger_id === triggerSelected ).default_trigger_name; %></li>
                                                <% }); %>
                                            <% } %>
                                        </p>
                                        <p class="card-footer text-white">Updated: <%= formattedUpdateDate %></p>             
                                    </a>
                                </div>
                            </div>
                            <% } %>        
                        <% }; %>
                    <% }); %>
                        </div>
                    </div>

                </container>
            </main>

            <%-  include('footer.ejs') %>

            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>                
        </div>
    </body>
</html>
